import{a as e,b as l,U as a,r as t,I as s,g6 as i,w as o,z as d,K as n,e as c,o as u,f as r,k as m,j as p,v,l as f,O as h,i as g,cZ as x,s as D,V as I,W as y,M as w,F as k,cO as b,cP as L,aL as C}from"./index.js";import{S as _}from"./index5.js";import j from"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";const U=e=>(b("data-v-800cf012"),e=e(),L(),e),B=U((()=>v("span",{class:"tip"},"按住这里可拖动",-1))),M={class:"p-4"},O={class:"row"},z=U((()=>v("div",null,"分组",-1))),R={class:"flex-1"},$={class:"row"},A=U((()=>v("div",null,"仅主人",-1))),E={class:"flex justify-between align-center flex-wrap"},N={class:"flex justify-start"},S={class:"flex flex-1 justify-end"},V={key:0},P={class:"row"},T=U((()=>v("div",null,"标题",-1))),F={class:"flex-1"},K={class:"row"},W=U((()=>v("div",null,"描述",-1))),Z={class:"flex-1"},q={class:"flex justify-between align-center"},G={class:"flex justify-start move-buttons"},H={class:"flex flex-1 justify-end"};var J=e(l({__name:"EditBodyModal",props:{panelCls:String,helpList:Object,modelData:Object,iconB64List:Array},emits:["update:modelData"],setup(e,{emit:l}){const b=e,L=l,{prefixCls:U}=a("miao-plugin-edit-modal"),{createConfirm:J}=C(),Q=t(!0),X=s((()=>Q.value?"model-event-none":"")),Y=t(!1);let ee=!1;const le=()=>{let e=b.modelData.groupIndex;b.helpList.splice(e,0,{group:"未命名分组",list:[]}),b.modelData.group=b.helpList[e],b.modelData.cellIndex=b.modelData.cell=null},ae=()=>{var e;let l=b.helpList[b.modelData.groupIndex];Array.isArray(l.list)||(l.list=[]);let a=null!=(e=b.modelData.cellIndex)?e:0;l.list.splice(a,0,{icon:1,title:"未命名项目",desc:"请添加描述"}),b.modelData.cell=l.list[a],b.modelData.cellIndex=a},te=e=>{let l,a=b.helpList,t=b.modelData.groupIndex;l=a[t],a[t]=a[t+e],a[t+e]=l,b.modelData.groupIndex+=e},se=e=>{if(-1===e&&0===b.modelData.cellIndex)return void ie(e);if(1===e&&b.modelData.cellIndex===b.helpList[b.modelData.groupIndex].list.length-1)return void ie(e);let l,a=b.helpList[b.modelData.groupIndex].list,t=b.modelData.cellIndex;l=a[t],a[t]=a[t+e],a[t+e]=l,b.modelData.cellIndex+=e};function ie(e){let l=-1===e?"上":"下";Q.value=!1,J({title:"跨分组移动",iconType:"warning",content:`确定要将该项目移动到${l}一个分组吗？`,onOk:()=>{let l,{modelData:a,helpList:t}=b,{cell:s,groupIndex:i,cellIndex:o}=a,d=t[i],n=t[i+e];-1===e?(n.list.push(s),d.list.splice(o,1),l=n.list.length-1):(n.list.unshift(s),d.list.splice(o,1),l=0),L("update:modelData",Object.assign({},a,{cellIndex:l,group:n,groupIndex:i+e}))},afterClose:()=>Q.value=!0})}function oe(e){let{modelData:l,helpList:a}=b;return-1===e?0===l.groupIndex&&0===l.cellIndex:1===e&&(l.groupIndex===a.length-1&&l.cellIndex===a[l.groupIndex].list.length-1)}const de=()=>{b.helpList.splice(b.modelData.groupIndex,1),b.modelData.show=!1},ne=()=>{let e=b.helpList[b.modelData.groupIndex],l=b.modelData.cellIndex;if(e.list.splice(l,1),0==e.list.length)b.modelData.cell=null,b.modelData.cellIndex=null;else{let a=l;a>=e.list.length&&(a=e.list.length-1),b.modelData.cell=e.list[a],b.modelData.cellIndex=a}},ce=()=>{Y.value=!0,ee=!0},ue=t(null),{x:re,y:me,isDragging:pe}=i(ue),ve=t(0),fe=t(0),he=t(!1),ge=t(0),xe=t(0),De=t(0),Ie=t(0),ye=t({left:0,right:0,top:0,bottom:0});o([re,me],(()=>{if(!he.value){ve.value=re.value,fe.value=me.value;const e=document.body.getBoundingClientRect(),l=ue.value.getBoundingClientRect();ye.value.right=e.width-l.width,ye.value.bottom=e.height-l.height,De.value=ge.value,Ie.value=xe.value}he.value=!0})),o(pe,(()=>{pe||(he.value=!1)})),d((()=>{he.value&&(ge.value=De.value+Math.min(Math.max(ye.value.left,re.value),ye.value.right)-ve.value,xe.value=Ie.value+Math.min(Math.max(ye.value.top,me.value),ye.value.bottom)-fe.value)}));const we=s((()=>({transform:`translate(${ge.value}px, ${xe.value}px)`})));function ke(e){var l,a,t;if(null==(l=b.modelData)?void 0:l.show){if(!Q.value)return;if(ee)return;let l=e.composedPath();for(let e of l)if((null==(a=e.classList)?void 0:a.contains(U))||(null==(t=e.classList)?void 0:t.contains(b.panelCls)))return;b.modelData.show=!1}}function be(){ee=!1}return window.addEventListener("click",ke),n((()=>{window.removeEventListener("click",ke)})),(l,a)=>{const t=c("a-input"),s=c("Icon"),i=c("a-button"),o=c("a-popconfirm"),d=c("a-divider");return u(),r(k,null,[m(D(w),{visible:e.modelData.show,"onUpdate:visible":a[8]||(a[8]=l=>e.modelData.show=l),footer:null,mask:!1,class:y(D(U)),wrapClassName:X.value},{title:p((()=>[v("div",{ref_key:"modalTitleRef",ref:ue,style:{width:"100%",cursor:"move",margin:"0"}},[f(" 编辑内容 "),B],512)])),modalRender:p((({originVNode:e})=>[v("div",{style:h(we.value)},[(u(),g(x(e)))],4)])),default:p((()=>[v("div",M,[v("div",O,[z,v("div",R,[m(t,{value:e.modelData.group.group,"onUpdate:value":a[0]||(a[0]=l=>e.modelData.group.group=l),placeholder:"分组"},null,8,["value"])])]),v("div",$,[A,m(D(_),{checked:e.modelData.group.auth,"onUpdate:checked":a[1]||(a[1]=l=>e.modelData.group.auth=l),checkedValue:"master","checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),v("div",E,[v("div",N,[m(i,{class:"ml-4",disabled:0===e.modelData.groupIndex,type:"primary",shape:"circle",size:"medium",onClick:a[2]||(a[2]=e=>te(-1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-up"})])),_:1},8,["disabled"]),m(i,{class:"ml-4",disabled:e.modelData.groupIndex===e.helpList.length-1,type:"primary",shape:"circle",size:"medium",onClick:a[3]||(a[3]=e=>te(1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-down"})])),_:1},8,["disabled"])]),v("div",S,[e.modelData.cell?I("",!0):(u(),g(i,{key:0,class:"ml-4",onClick:ae},{default:p((()=>[f("添加项目")])),_:1})),m(i,{class:"ml-4",type:"success",onClick:le},{default:p((()=>[f("添加分组")])),_:1}),m(o,{title:"确定删除？",onConfirm:de},{default:p((()=>[m(i,{class:"ml-4",type:"default",danger:""},{default:p((()=>[f("删除该组")])),_:1})])),_:1})])]),e.modelData.cell?(u(),r("div",V,[m(d,{style:{margin:"16px 0"}}),v("div",{class:"icon",onClick:ce,style:h(`background: url(${e.iconB64List[e.modelData.cell.icon]}) 0 0 no-repeat`)},null,4),v("div",P,[T,v("div",F,[m(t,{value:e.modelData.cell.title,"onUpdate:value":a[4]||(a[4]=l=>e.modelData.cell.title=l),placeholder:"标题"},null,8,["value"])])]),v("div",K,[W,v("div",Z,[m(t,{value:e.modelData.cell.desc,"onUpdate:value":a[5]||(a[5]=l=>e.modelData.cell.desc=l),placeholder:"描述"},null,8,["value"])])]),v("div",q,[v("div",G,[m(i,{class:y(["ml-4",["ml-4",{warn:0===e.modelData.cellIndex}]]),disabled:oe(-1),type:"primary",shape:"circle",size:"medium",onClick:a[6]||(a[6]=e=>se(-1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-left"})])),_:1},8,["class","disabled"]),m(i,{class:y(["ml-4",["ml-4",{warn:e.modelData.cellIndex===e.helpList[e.modelData.groupIndex].list.length-1}]]),disabled:oe(1),type:"primary",shape:"circle",size:"medium",onClick:a[7]||(a[7]=e=>se(1))},{default:p((()=>[m(s,{icon:"akar-icons:arrow-right"})])),_:1},8,["class","disabled"])]),v("div",H,[m(i,{class:"ml-4",type:"success",onClick:ae},{default:p((()=>[f("添加项目")])),_:1}),m(o,{title:"确定删除？",onConfirm:ne},{default:p((()=>[m(i,{class:"ml-4",type:"default",danger:""},{default:p((()=>[f("删除该项")])),_:1})])),_:1})])])])):I("",!0)])])),_:1},8,["visible","class","wrapClassName"]),e.modelData.cell?(u(),g(j,{key:0,visible:Y.value,"onUpdate:visible":a[9]||(a[9]=e=>Y.value=e),cell:e.modelData.cell,"onUpdate:cell":a[10]||(a[10]=l=>e.modelData.cell=l),iconB64List:e.iconB64List,afterClose:be},null,8,["visible","cell","iconB64List"])):I("",!0)],64)}}}),[["__scopeId","data-v-800cf012"]]);export{J as default};
