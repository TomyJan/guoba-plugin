var e=(e,t,s)=>new Promise(((a,l)=>{var n=e=>{try{o(s.next(e))}catch(t){l(t)}},i=e=>{try{o(s.throw(e))}catch(t){l(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);o((s=s.apply(e,t)).next())}));import{b as t,r as s,I as a,J as l,w as n,e as i,o,f as r,k as u,s as p,aD as c,v as d,i as m,l as v,j as y,V as f,F as j,x,q as k,a as g,cN as h,cO as w,aL as _}from"./index.js";import{P as b,A as F}from"./BasicForm.js";import{u as A}from"./hooks.js";import"./index4.js";import"./index5.js";import"./useFormItem.js";import"./index3.js";import"./DeleteOutlined.js";import"./transButton.js";import"./index2.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";import"./upperFirst.js";import"./download.js";import"./index6.js";import"./index7.js";import"./uniqBy.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";const I=e=>(h("data-v-667832d1"),e=e(),w(),e),O={class:"step-box"},P={key:0,class:"step-tip"},T={key:1,class:"step-tip"},z={key:2,class:"step-tip"},S=I((()=>d("span",null,"正在迁移中",-1))),B=I((()=>d("br",null,null,-1))),C=I((()=>d("br",null,null,-1))),R={style:{width:"90%"}},q=I((()=>d("br",null,null,-1)));var D=g(t({__name:"Step2",setup(t){const{createConfirm:g}=_(),h=A(),w=s(),I=a((()=>3===h.status.state)),D=a((()=>h.status.reason)),H=a((()=>h.status.percent)),J=a((()=>h.status.logs.join("\n")));function L(){g({title:"取消迁移",iconType:"warning",content:"确定要取消迁移吗？取消后不会删除已迁移的文件，但下次迁移时就只能从头开始了。",onOk(){return e(this,null,(function*(){yield x.put({url:"/v2-transfer/stop"}),yield h.updateStatus()}))}})}function N(){g({title:"返回",iconType:"warning",content:"确定要重置迁移状态并返回吗？",onOk(){return e(this,null,(function*(){yield x.post({url:"/v2-transfer/reset"}),yield h.updateStatus()}))}})}return l((()=>{!function(){n(J,(()=>e(this,null,(function*(){var e,t;if(yield k(),null==(t=null==(e=w.value)?void 0:e.resizableTextArea)?void 0:t.textArea){let e=w.value.resizableTextArea.textArea;e.scrollTop=e.scrollHeight}}))),{immediate:!0,deep:!0})}(),n([H,I],(()=>{H.value>=100||I.value?h.stopPolling():h.startPolling()}),{immediate:!0})})),(e,t)=>{const s=i("a-textarea"),a=i("a-button"),l=i("a-col"),n=i("a-row");return o(),r("div",O,[I.value?(o(),r("div",P,"迁移失败")):100===H.value?(o(),r("div",T,"迁移成功")):(o(),r("div",z,[S,u(p(c))])),B,u(p(b),{type:"circle",percent:H.value,status:I.value?"exception":void 0},null,8,["percent","status"]),C,d("div",R,[I.value?(o(),m(p(F),{key:0,message:`迁移失败：${D.value}`,type:"error","show-icon":""},null,8,["message"])):100===H.value?(o(),m(p(F),{key:1,message:"迁移成功！快去愉快地玩耍吧！",type:"success","show-icon":""})):(o(),m(p(F),{key:2,message:"在迁移结束之前，请勿重启或关闭云崽",type:"warning","show-icon":""})),q,v(" 迁移日志： "),u(s,{ref_key:"logRef",ref:w,value:J.value,"auto-size":{minRows:10,maxRows:10}},null,8,["value"]),100!==H.value?(o(),m(n,{key:3,class:"footer-btn"},{default:y((()=>[u(l,{span:12},{default:y((()=>[I.value?(o(),m(a,{key:0,type:"link",preIcon:"ant-design:undo",onClick:N},{default:y((()=>[v(" 返回重新选择配置 ")])),_:1})):f("",!0)])),_:1}),u(l,{span:12,style:{"text-align":"right"}},{default:y((()=>[I.value?(o(),r(j,{key:0},[],64)):(o(),m(a,{key:1,type:"link",danger:"",preIcon:"ant-design:close-circle",onClick:L},{default:y((()=>[v(" 取消迁移 ")])),_:1}))])),_:1})])),_:1})):f("",!0)])])}}}),[["__scopeId","data-v-667832d1"]]);export{D as default};
