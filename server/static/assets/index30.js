var e=(e,t,a)=>new Promise(((o,n)=>{var i=e=>{try{l(a.next(e))}catch(t){n(t)}},r=e=>{try{l(a.throw(e))}catch(t){n(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,r);l((a=a.apply(e,t)).next())}));import{a as t,b as a,U as o,r as n,c as i,w as r,e as l,o as m,i as s,j as p,k as u,v as d,ax as h,V as c,W as g,aL as f}from"./index.js";import{P as j}from"./index13.js";import v from"./MiaoHeader.js";import y from"./HelpPanel.js";import x from"./ThemeDrawer.js";import B from"./BackupDrawer.js";import D from"./SettingDrawer.js";import{s as N,g as w,a as S}from"./miao.api.js";import{u as C}from"./index31.js";import{l as T}from"./lodash.default.js";import"./index15.js";import"./onMountedOrActivated.js";import"./useWindowSizeFn.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./transButton.js";import"./EditBodyModal.js";import"./index5.js";import"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";import"./index2.js";import"./FullscreenOutlined.js";import"./common.js";import"./HelpComps.js";import"./UploadIconHelpModal.js";import"./21ae6624.js";import"./PathSelect.js";import"./index3.js";import"./ThemeConfigModal.js";import"./BasicForm.js";import"./index4.js";import"./useFormItem.js";import"./DeleteOutlined.js";import"./upperFirst.js";import"./download.js";import"./index6.js";import"./index7.js";import"./uniqBy.js";import"./miao.data.js";import"./ThemeConfigForm.js";import"./base64Conver.js";import"./index10.js";import"./throttle.js";import"./merge.js";const b=a({name:"MiaoPluginExtra",components:{HelpPanel:y,EditMiaoHeader:v,PageWrapper:j,ThemeDrawer:x,BackupDrawer:B,SettingDrawer:D},setup(){const{prefixCls:t}=o("edit-miao-help"),{createMessage:a,createConfirm:l}=f(),m=n(!0),s=n(!0),p=n(0),u=n(null),d=n(null),h=n(null),c=n(null),g=n(null),j=i({miao:"x.x.x",yunzai:"x.x.x"}),v=n({show:!1,cell:null,cellIndex:null,group:null,groupIndex:null}),y=n([]),x=n({}),B=n(""),D=n();let b=null;r([B,()=>{var e;return null==(e=u.value)?void 0:e.theme},()=>{var e;return null==(e=u.value)?void 0:e.themeExclude}],(()=>{D.value=(()=>{var e,t;if("string"==typeof b)return b;if(B.value)return B.value;let a=[],o=null==(e=u.value)?void 0:e.theme,n=null==(t=u.value)?void 0:t.themeExclude,i=y.value;T.isArray(o)?a=T.intersection(o,i):"all"===o&&(a=i),n&&T.isArray(n)&&(a=T.difference(a,n)),0===a.length&&(a=["default"]);let r=T.sample(a);return i&&i.length>0&&null==b&&(b=r),r})()}),{deep:!0,immediate:!0});const[k,L]=C(),[U,M]=C(),[R,O]=C();const P=()=>e(this,null,(function*(){try{s.value=!0;let e=yield w();u.value=e.helpCfg,d.value=e.helpList,y.value=e.themeNames,j.miao=e.miaoVersion,j.yunzai=e.yunzaiVersion,h.value=null,c.value=null,g.value=yield S()}finally{s.value=!1,m.value=!1,p.value++}}));return P(),{prefixCls:t,loading:s,pageLoading:m,helpCfg:u,helpList:d,themeNames:y,themeStyle:x,themeName:D,debugThemeName:B,bgB64:h,mainB64:c,iconB64List:g,cacheVer:p,versions:j,modelData:v,onBackup:function(){M.openDrawer(!0,{})},onOpenTheme:function(){L.openDrawer(!0,{})},onRollback:function(){l({title:"提示",iconType:"warning",content:"确定要放弃所有修改吗？",onOk:()=>{P()}})},onOpenSetting:function(){O.openDrawer()},loadData:P,saveData:()=>e(this,null,(function*(){try{s.value=!0,yield N(u,d,g,c),yield P(),a.success("保存成功~")}finally{s.value=!1}})),onSettingModalChange:function(){setTimeout((()=>b=-1),300)},registerThemeDrawer:k,registerBackupDrawer:U,registerSettingDrawer:R}}}),k={class:"flex justify-center md:pt-4 my-4"};var L=t(b,[["render",function(e,t,a,o,n,i){const r=l("EditMiaoHeader"),f=l("HelpPanel"),j=l("ThemeDrawer"),v=l("BackupDrawer"),y=l("SettingDrawer"),x=l("PageWrapper");return m(),s(x,{class:g([e.prefixCls]),title:"编辑喵喵帮助",dense:"",sticky:"",stickyTop:"-14px",loading:e.loading},{headerContent:p((()=>[u(r,{onSave:e.saveData,onRollback:e.onRollback,onBackup:e.onBackup,onTheme:e.onOpenTheme},null,8,["onSave","onRollback","onBackup","onTheme"])])),default:p((()=>[d("div",k,[u(h,{name:"scroll-y-reverse-transition"},{default:p((()=>[e.pageLoading?c("",!0):(m(),s(f,{key:0,cacheVer:e.cacheVer,versions:e.versions,themeNames:e.themeNames,helpCfg:e.helpCfg,"onUpdate:helpCfg":t[0]||(t[0]=t=>e.helpCfg=t),helpList:e.helpList,"onUpdate:helpList":t[1]||(t[1]=t=>e.helpList=t),bgB64:e.bgB64,"onUpdate:bgB64":t[2]||(t[2]=t=>e.bgB64=t),mainB64:e.mainB64,"onUpdate:mainB64":t[3]||(t[3]=t=>e.mainB64=t),iconB64List:e.iconB64List,"onUpdate:iconB64List":t[4]||(t[4]=t=>e.iconB64List=t),modelData:e.modelData,"onUpdate:modelData":t[5]||(t[5]=t=>e.modelData=t),themeStyle:e.themeStyle,"onUpdate:themeStyle":t[6]||(t[6]=t=>e.themeStyle=t),themeName:e.themeName,"onUpdate:themeName":t[7]||(t[7]=t=>e.themeName=t),onOpenSetting:e.onOpenSetting},null,8,["cacheVer","versions","themeNames","helpCfg","helpList","bgB64","mainB64","iconB64List","modelData","themeStyle","themeName","onOpenSetting"]))])),_:1})]),u(j,{themeNames:e.themeNames,"onUpdate:themeNames":t[8]||(t[8]=t=>e.themeNames=t),onRegister:e.registerThemeDrawer},null,8,["themeNames","onRegister"]),u(v,{onRegister:e.registerBackupDrawer,onReload:e.loadData},null,8,["onRegister","onReload"]),u(y,{model:e.helpCfg,"onUpdate:model":[t[9]||(t[9]=t=>e.helpCfg=t),e.onSettingModalChange],themeName:e.themeName,themeNames:e.themeNames,themeStyle:e.themeStyle,"onUpdate:themeStyle":t[10]||(t[10]=t=>e.themeStyle=t),debugThemeName:e.debugThemeName,"onUpdate:debugThemeName":t[11]||(t[11]=t=>e.debugThemeName=t),onRegister:e.registerSettingDrawer},null,8,["model","themeName","themeNames","themeStyle","debugThemeName","onRegister","onUpdate:model"])])),_:1},8,["class","loading"])}]]);export{L as default};
