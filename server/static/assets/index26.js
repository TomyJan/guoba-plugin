var e=(e,t,o)=>new Promise(((s,n)=>{var l=e=>{try{a(o.next(e))}catch(t){n(t)}},i=e=>{try{a(o.throw(e))}catch(t){n(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,i);a((o=o.apply(e,t)).next())}));import{b as t,r as o,I as s,c as n,k as l,w as i,l as a,g1 as r,e as u,o as c,i as p,j as d,s as m,V as f,v as g,eT as y,m as h,aL as j,cO as x,cP as w,u as b,a as v}from"./index.js";import{B as k}from"./TableImg.js";import{T as C}from"./BasicForm.js";import{u as P}from"./useTable.js";import R from"./TableBatchDropdown.js";import{P as K}from"./index13.js";import{a as A}from"./index2.js";import{columns as I}from"./plugins.data.js";import{u as O}from"./index25.js";import{G as T}from"./GPluginModal.js";import"./PathSelect.js";import{a as B}from"./common.js";import"./index3.js";import"./index4.js";import"./index5.js";import"./merge.js";import"./upperFirst.js";import"./useWindowSizeFn.js";import"./onMountedOrActivated.js";import"./sortable.esm.js";import"./RedoOutlined.js";import"./FullscreenOutlined.js";import"./scrollTo.js";import"./index20.js";import"./index21.js";import"./useFormItem.js";import"./DeleteOutlined.js";import"./transButton.js";import"./download.js";import"./index6.js";import"./index7.js";import"./uniqBy.js";import"./index15.js";import"./useContentViewHeight.js";import"./ArrowLeftOutlined.js";import"./guoba.js";import"./index14.js";import"./MarkdownViewer.js";import"./lodash.default.js";import"./throttle.js";const M=(e=>(x("data-v-519cace6"),e=e(),w(),e))((()=>g("a",{href:"https://gitee.com/yhArcadia/Yunzai-Bot-plugins-index",target:"_blank"}," Yunzai-Bot插件索引 ",-1))),S=["onClick"];var _=v(t({__name:"index",setup(t){const x=O(),w=o(!1),v=o(1),_=o([]),F=s((()=>_.value.reduce(((e,t)=>{let o=t.author;return Array.isArray(o)||(o=[o]),o.forEach((t=>{e.includes(t)||e.push(t)})),e}),[]).map((e=>({label:e.replace(/^@/,""),value:e}))))),[G,{openModal:z}]=A(),q=n({}),D=n({type:"checkbox",selectedRowKeys:[],onChange:e=>{D.selectedRowKeys=e}}),[E,{reload:L,updateTableDataRecord:V}]=P({title:()=>{let t="",o=!1;return 0===v.value?t="未安装的插件":0===D.selectedRowKeys.length?t="已安装的插件":(o=!0,t=`已选中 ${D.selectedRowKeys.length} 个插件`),l(R,{showBatch:o,text:t,onClear:()=>D.selectedRowKeys=[],onMenuClick:t=>{if("uninstall-batch"===t.key)!function(){$({title:"批量卸载",iconType:"warning",content:l("div",null,[l("p",null,[a("确定要批量卸载以下插件吗？")]),l("p",null,[l("ul",null,[D.selectedRowKeys.map(((e,t)=>l("li",{key:e},[t+1,a(". "),e])))])]),l("p",null,[a("将会删除插件目录包括可能产生的数据以及配置，且无法恢复！")]),l("p",null,[a("请谨慎操作，卸载后会立即重启！")])]),onOk:()=>e(this,null,(function*(){try{w.value=!0;const t=D.selectedRowKeys.join(",");let o=yield r.uninstallPlugin(t);if("success"===o.status){let t=o.message.split("\n");J({title:"批量卸载完成",content:l("div",null,[t.map((e=>l("span",null,[e,l("br",null,null)])))]),onOk(){return e(this,null,(function*(){yield B(3e3),window.location.reload()}))}})}else W.error(o.message)}finally{w.value=!1}}))})}()}},null)},api:function(t){return e(this,null,(function*(){const e=yield x.getPlugins();if(!e||0===e.length)return[];_.value=e;let{keywords:o="",authors:s=[]}=t;return Array.isArray(s)||(s=[]),e.filter((e=>{if(!(1===v.value?e.installed:!e.installed))return!1;if(o){const t=new RegExp(o,"i");if(!t.test(e.title)&&!t.test(e.name)&&!t.test(e.description))return!1}if(s.length>0){let t=e.author;if(Array.isArray(t)||(t=[t]),!t.some((e=>s.includes(e))))return!1}return!0}))}))},rowKey:"name",columns:I,useSearchForm:!0,formConfig:{baseColProps:{xs:24,sm:8,md:6,lg:8,xl:8,xxl:8},actionColOptions:{xs:24,sm:8,md:8,lg:8,xl:8,xxl:8,style:{paddingLeft:"8px",textAlign:"left"}},labelCol:{xs:24,sm:6},wrapperCol:{xs:24,sm:18},schemas:[{label:"过滤正则",field:"keywords",component:"Input",componentProps:{placeholder:"可匹配插件标题、插件名称、插件说明",onPressEnter:()=>L()}},{label:"插件作者",field:"authors",component:"Select",componentProps:()=>({placeholder:"请选择插件作者",mode:"multiple",options:F.value})}]},showTableSetting:!0,bordered:!0,canResize:!1,pagination:!0,indexColumnProps:{title:"#"},actionColumn:{width:80,title:"操作",dataIndex:"action"}});function H({isUpdate:e,values:t}){if(e){const e=V(t.id,t);console.log(e)}else L()}function U(e){z(!0,{plugin:e})}i(v,(()=>{D.selectedRowKeys=[],L()}));const{createPrompt:Y}=b(),{createMessage:W,createConfirm:$,createInfoModal:J}=j();function N(){return e(this,null,(function*(){Y({title:"安装自定义插件",required:!0,placeholder:"请输入插件 Git 地址",bottomHelpMessage:"仅支持安装 Plugin 插件，请自行验证插件是否安全",rules:[{required:!0,message:"请输入插件 Git 地址"},{type:"url",message:"请输入正确的 Git 地址"}],okText:"安装",onOk(t){return e(this,null,(function*(){let e=yield r.installPlugin(t);"success"===e.status?(W.success(e.message),yield B(3e3),window.location.reload()):W.error(e.message)}))}})}))}return(e,t)=>{const o=u("a-tab-pane"),s=u("a-tabs"),n=u("a-button");return c(),p(m(K),{title:"插件管理",loading:w.value},{headerContent:d((()=>[a(" 插件列表来源： "),M])),footer:d((()=>[l(s,{activeKey:v.value,"onUpdate:activeKey":t[0]||(t[0]=e=>v.value=e)},{default:d((()=>[(c(),p(o,{key:1,tab:"已安装"})),(c(),p(o,{key:0,tab:"未安装"}))])),_:1},8,["activeKey"])])),default:d((()=>[l(m(k),{onRegister:m(E),searchInfo:q,rowSelection:D},{bodyCell:d((({column:e,record:t})=>["action"===e.key?(c(),p(m(C),{key:0,actions:[{icon:"clarity:info-standard-line",tooltip:"查看插件详情",onClick:U.bind(null,t)}]},null,8,["actions"])):f("",!0)])),"plugin-title":d((({record:e})=>[g("a",{onClick:y((()=>U(e)),["stop"])},h(e.title),9,S)])),_:1},8,["onRegister","searchInfo","rowSelection"]),l(T,{onRegister:m(G),onSuccess:H},null,8,["onRegister"]),l(n,{type:"primary",shape:"circle",preIcon:"ant-design:plus",class:"float-button",onClick:N})])),_:1},8,["loading"])}}}),[["__scopeId","data-v-519cace6"]]);export{_ as default};
